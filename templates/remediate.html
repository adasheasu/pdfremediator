<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive WCAG 2.2 AA Remediation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .issue-card {
            background: #f8f9fa;
            border-left: 5px solid #ff9800;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .issue-card.critical {
            border-left-color: #d32f2f;
            background: #ffebee;
        }

        .issue-card.warning {
            border-left-color: #ff9800;
            background: #fff8e1;
        }

        .issue-card.info {
            border-left-color: #2196f3;
            background: #e3f2fd;
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .issue-title {
            font-size: 1.5em;
            color: #2c3e50;
            font-weight: 600;
        }

        .issue-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
        }

        .issue-badge.critical {
            background: #d32f2f;
        }

        .issue-badge.warning {
            background: #ff9800;
        }

        .issue-badge.info {
            background: #2196f3;
        }

        .guideline-tag {
            display: inline-block;
            background: #34495e;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
        }

        .issue-description {
            font-size: 1.1em;
            margin: 20px 0;
            color: #555;
        }

        .code-preview {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 15px 0;
        }

        .suggestion-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .suggestion-box.visible {
            display: block;
        }

        .suggestion-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .btn:focus {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #388e3c;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #2196f3;
            color: white;
        }

        .btn-info:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .completion-screen {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .completion-screen.visible {
            display: block;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß Interactive WCAG 2.2 AA Remediation</h1>
            <p style="color: #7f8c8d; font-size: 1.1em;">Step through each accessibility issue and choose to auto-fix or manually remediate</p>
        </header>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>

        <div id="loadingScreen" class="loading">
            <div class="spinner"></div>
            <p>Loading accessibility issues...</p>
        </div>

        <div id="issueContainer" style="display: none;">
            <div class="issue-card" id="issueCard">
                <div class="issue-header">
                    <div>
                        <div class="issue-title" id="issueTitle"></div>
                        <div id="guidelineTags"></div>
                    </div>
                    <span class="issue-badge" id="issueBadge"></span>
                </div>

                <div class="issue-description" id="issueDescription"></div>

                <div id="codePreview"></div>

                <div class="suggestion-box" id="suggestionBox">
                    <div class="suggestion-title">üí° How to Fix This:</div>
                    <div id="suggestionContent"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" id="autoFixBtn">
                        üîß Auto-Fix This Issue
                    </button>
                    <button class="btn btn-info" id="showSuggestionBtn">
                        üí° Show Me How to Fix
                    </button>
                    <button class="btn btn-secondary" id="skipBtn">
                        ‚è≠Ô∏è Skip for Now
                    </button>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" disabled>
                    ‚Üê Previous Issue
                </button>
                <span id="issueCounter" style="font-size: 1.1em; color: #7f8c8d;">
                    Issue 1 of X
                </span>
                <button class="btn btn-secondary" id="nextBtn">
                    Next Issue ‚Üí
                </button>
            </div>
        </div>

        <div id="completionScreen" class="completion-screen">
            <div class="completion-icon">üéâ</div>
            <h2 style="color: #27ae60; font-size: 2.5em; margin-bottom: 20px;">Remediation Complete!</h2>
            <p style="font-size: 1.2em; color: #555; margin-bottom: 30px;">
                You've reviewed all accessibility issues for this document.
            </p>

            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="fixedCount">0</div>
                    <div class="stat-label">Issues Fixed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="skippedCount">0</div>
                    <div class="stat-label">Issues Skipped</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="complianceScore">0%</div>
                    <div class="stat-label">Compliance Score</div>
                </div>
            </div>

            <div class="button-group" style="justify-content: center; margin-top: 40px;">
                <button class="btn btn-success" id="downloadFixedHtml">
                    üì• Download Fixed HTML
                </button>
                <button class="btn btn-primary" id="downloadFixedPdf">
                    üì• Download Fixed PDF
                </button>
                <button class="btn btn-secondary" id="backToHome">
                    üè† Back to Home
                </button>
            </div>
        </div>
    </div>

    <script>
        const sessionId = '{{ session_id }}';
        let issues = [];
        let currentIssueIndex = 0;
        let fixedIssues = [];
        let skippedIssues = [];

        // Load issues on page load
        async function loadIssues() {
            try {
                const response = await fetch(`/api/issues/${sessionId}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load issues');
                }

                issues = data.issues;

                if (issues.length === 0) {
                    showCompletion();
                } else {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('issueContainer').style.display = 'block';
                    showIssue(0);
                }
            } catch (error) {
                document.getElementById('loadingScreen').innerHTML =
                    `<p style="color: #d32f2f;">Error: ${error.message}</p>`;
            }
        }

        function showIssue(index) {
            if (index < 0 || index >= issues.length) return;

            currentIssueIndex = index;
            const issue = issues[index];

            // Update card styling
            const card = document.getElementById('issueCard');
            card.className = `issue-card ${issue.severity}`;

            // Update badge
            const badge = document.getElementById('issueBadge');
            badge.className = `issue-badge ${issue.severity}`;
            badge.textContent = issue.severity.toUpperCase();

            // Update title
            document.getElementById('issueTitle').textContent = issue.title;

            // Update guideline tags
            const tagsHtml = issue.guidelines.map(g =>
                `<span class="guideline-tag">${g}</span>`
            ).join('');
            document.getElementById('guidelineTags').innerHTML = tagsHtml;

            // Update description
            document.getElementById('issueDescription').textContent = issue.description;

            // Update code preview if available
            if (issue.element_preview) {
                document.getElementById('codePreview').innerHTML =
                    `<strong>Found in:</strong><br><code>${escapeHtml(issue.element_preview)}</code>`;
                document.getElementById('codePreview').style.display = 'block';
            } else {
                document.getElementById('codePreview').style.display = 'none';
            }

            // Update suggestion content
            document.getElementById('suggestionContent').innerHTML = issue.remediation;

            // Hide suggestion box by default
            document.getElementById('suggestionBox').classList.remove('visible');

            // Update counter
            document.getElementById('issueCounter').textContent =
                `Issue ${index + 1} of ${issues.length}`;

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === issues.length - 1;

            // Update progress
            updateProgress();
        }

        function updateProgress() {
            const total = issues.length;
            const completed = fixedIssues.length + skippedIssues.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
        }

        async function autoFixIssue() {
            const issue = issues[currentIssueIndex];

            try {
                const response = await fetch(`/api/fix-issue/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        issue_id: issue.id,
                        issue_type: issue.type
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to fix issue');
                }

                fixedIssues.push(issue.id);
                moveToNext();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function showSuggestion() {
            const box = document.getElementById('suggestionBox');
            box.classList.toggle('visible');

            const btn = document.getElementById('showSuggestionBtn');
            if (box.classList.contains('visible')) {
                btn.textContent = 'üîº Hide Suggestion';
            } else {
                btn.textContent = 'üí° Show Me How to Fix';
            }
        }

        function skipIssue() {
            const issue = issues[currentIssueIndex];
            skippedIssues.push(issue.id);
            moveToNext();
        }

        function moveToNext() {
            if (currentIssueIndex < issues.length - 1) {
                showIssue(currentIssueIndex + 1);
            } else {
                showCompletion();
            }
        }

        function showCompletion() {
            document.getElementById('issueContainer').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'none';

            const completionScreen = document.getElementById('completionScreen');
            completionScreen.classList.add('visible');

            // Update stats
            document.getElementById('fixedCount').textContent = fixedIssues.length;
            document.getElementById('skippedCount').textContent = skippedIssues.length;

            const total = issues.length;
            const complianceScore = total > 0 ? Math.round((fixedIssues.length / total) * 100) : 100;
            document.getElementById('complianceScore').textContent = `${complianceScore}%`;

            updateProgress();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        document.getElementById('autoFixBtn').addEventListener('click', autoFixIssue);
        document.getElementById('showSuggestionBtn').addEventListener('click', showSuggestion);
        document.getElementById('skipBtn').addEventListener('click', skipIssue);
        document.getElementById('prevBtn').addEventListener('click', () => showIssue(currentIssueIndex - 1));
        document.getElementById('nextBtn').addEventListener('click', () => showIssue(currentIssueIndex + 1));

        document.getElementById('downloadFixedHtml').addEventListener('click', () => {
            window.location.href = `/download/${sessionId}/html`;
        });

        document.getElementById('downloadFixedPdf').addEventListener('click', () => {
            window.location.href = `/download/${sessionId}/pdf`;
        });

        document.getElementById('backToHome').addEventListener('click', () => {
            window.location.href = '/';
        });

        // Load issues on startup
        loadIssues();
    </script>
</body>
</html>
